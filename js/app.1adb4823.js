(function(){"use strict";var e={2978:function(e,t,o){var n=o(3751),s=o(641);function r(e,t,o,n,r,a){const c=(0,s.g2)("DifferentuseGS3");return(0,s.uX)(),(0,s.Wv)(c,{msg:"Welcome to Your Vue.js App"})}var a=o(33);const c=e=>((0,s.Qi)("data-v-45aea742"),e=e(),(0,s.jt)(),e),i=c((()=>(0,s.Lk)("h1",null,"Google Sheets Data",-1))),l={key:0},h={key:1},d={key:2},u=c((()=>(0,s.Lk)("h3",null,"Add New Entry",-1))),g=c((()=>(0,s.Lk)("label",{for:"id"},"ID:",-1))),f=c((()=>(0,s.Lk)("label",{for:"name"},"Name:",-1))),p=c((()=>(0,s.Lk)("label",{for:"password"},"Password:",-1))),k={key:3},w=c((()=>(0,s.Lk)("p",null,"你还没有登录，请点击下方按钮进行授权登录。",-1)));function v(e,t,o,r,c,v){return(0,s.uX)(),(0,s.CE)("div",null,[i,c.loading?((0,s.uX)(),(0,s.CE)("div",l,"Loading...")):(0,s.Q3)("",!0),c.error?((0,s.uX)(),(0,s.CE)("div",h,(0,a.v_)(c.error),1)):(0,s.Q3)("",!0),c.sheetsData.length?((0,s.uX)(),(0,s.CE)("table",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.sheetsData,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e,((e,t)=>((0,s.uX)(),(0,s.CE)("td",{key:t},(0,a.v_)(e),1)))),128))])))),128))])):(0,s.Q3)("",!0),u,(0,s.Lk)("div",null,[g,(0,s.bo)((0,s.Lk)("input",{id:"id","onUpdate:modelValue":t[0]||(t[0]=e=>c.newEntry.id=e),placeholder:"Enter ID"},null,512),[[n.Jo,c.newEntry.id]])]),(0,s.Lk)("div",null,[f,(0,s.bo)((0,s.Lk)("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=e=>c.newEntry.name=e),placeholder:"Enter Name"},null,512),[[n.Jo,c.newEntry.name]])]),(0,s.Lk)("div",null,[p,(0,s.bo)((0,s.Lk)("input",{id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>c.newEntry.password=e),placeholder:"Enter Password"},null,512),[[n.Jo,c.newEntry.password]])]),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>v.addRow&&v.addRow(...e))},"Add New Row"),c.needsLogin?((0,s.uX)(),(0,s.CE)("div",k,[w,(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>v.redirectToGoogleLogin&&v.redirectToGoogleLogin(...e))},"登录 Google")])):(0,s.Q3)("",!0)])}o(4603),o(7566),o(8721);var m={data(){return{sheetsData:[],loading:!1,error:null,accessToken:null,newEntry:{id:"",name:"",password:""},needsLogin:!1,refreshInterval:null}},mounted(){this.handleRedirect(),this.startAutoRefresh()},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval)},methods:{handleRedirect(){const e=new URLSearchParams(window.location.search),t=e.get("code");t?this.fetchAccessTokenByCode(t):this.initClient()},startAutoRefresh(){this.refreshInterval=setInterval((()=>{this.forceRefreshAccessToken()}),3e5)},async forceRefreshAccessToken(){const e=localStorage.getItem("refresh_token");e?(console.log("每5分钟强制刷新一次access_token..."),await this.fetchAccessToken(e)):console.log("没有可用的refresh_token，无法刷新access_token")},async fetchAccessTokenByCode(e){try{const t=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:"562278447012-g8107er0h2v1s3nidqe4svp3dd6o16i2.apps.googleusercontent.com",client_secret:"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",code:e,redirect_uri:"https://nicole-wang-ops.github.io/testdifuG/",grant_type:"authorization_code"})}),o=await t.json();if(console.log("获取 access_token 和 refresh_token 的响应:",o),o.access_token){this.accessToken=o.access_token;const e=Date.now();localStorage.setItem("access_token",o.access_token),localStorage.setItem("access_token_time",e),o.refresh_token&&localStorage.setItem("refresh_token",o.refresh_token),this.fetchGoogleSheetsData()}else this.error="Failed to retrieve access token."}catch(t){this.error="Error fetching access token: "+t.message}},initClient(){const e=localStorage.getItem("refresh_token");console.log("检查是否有 refresh_token:",e),e?(this.accessToken=localStorage.getItem("access_token"),this.fetchGoogleSheetsData()):(console.log("没有找到 refresh_token，提示用户需要登录"),this.needsLogin=!0)},async fetchAccessToken(e){try{console.log("正在使用 refresh_token 强制刷新 access_token...");const t=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:"562278447012-g8107er0h2v1s3nidqe4svp3dd6o16i2.apps.googleusercontent.com",client_secret:"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",refresh_token:e,grant_type:"refresh_token"})}),o=await t.json();if(console.log("刷新 access_token 的响应:",o),o.access_token){this.accessToken=o.access_token;const e=Date.now();localStorage.setItem("access_token",o.access_token),localStorage.setItem("access_token_time",e),console.log("access_token 已更新:",o.access_token)}else this.error="Failed to retrieve access token.",console.log("无法获取新的 access_token:",o)}catch(t){this.error="Error fetching access token: "+t.message,console.log("刷新 access_token 时发生错误:",t)}},async fetchGoogleSheetsData(){if(!this.accessToken)return void(this.error="Access token is required");this.loading=!0;const e="1p0VikCs8qqlMNTuWhHkZNrvFj913wqLy5N5rSgZwNTU",t="Sheet1!A1:C1000";fetch(`https://sheets.googleapis.com/v4/spreadsheets/${e}/values/${t}?access_token=${this.accessToken}`).then((e=>e.json())).then((e=>{this.sheetsData=e.values||[],this.loading=!1,console.log("成功获取 Google Sheets 数据:",this.sheetsData)})).catch((e=>{this.error="Error fetching data: "+e.message,this.loading=!1,console.log("获取 Google Sheets 数据时发生错误:",e)}))},async addRow(){const e=Date.now();if(localStorage.setItem("last_operation_time",e),console.log("记录当前操作时间:",new Date(e).toLocaleString()),!this.accessToken)return void(this.error="Access token is required");if(!this.newEntry.id||!this.newEntry.name||!this.newEntry.password)return void(this.error="All fields are required");const t="1p0VikCs8qqlMNTuWhHkZNrvFj913wqLy5N5rSgZwNTU",o="Sheet1",n={values:[[this.newEntry.id,this.newEntry.name,this.newEntry.password]]};fetch(`https://sheets.googleapis.com/v4/spreadsheets/${t}/values/${o}:append?valueInputOption=RAW&insertDataOption=INSERT_ROWS`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`},body:JSON.stringify(n)}).then((e=>e.json())).then((e=>{this.fetchGoogleSheetsData(),this.newEntry.id="",this.newEntry.name="",this.newEntry.password="",console.log("成功添加新行:",e)})).catch((e=>{this.error="Error adding row: "+e.message,console.log("添加新行时发生错误:",e)}))},redirectToGoogleLogin(){const e="562278447012-g8107er0h2v1s3nidqe4svp3dd6o16i2.apps.googleusercontent.com",t="https://nicole-wang-ops.github.io/testdifuG/",o="https://www.googleapis.com/auth/spreadsheets",n=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${e}&redirect_uri=${t}&response_type=code&scope=${o}&access_type=offline&prompt=consent`;console.log("重定向到:",n),window.location.href=n}}},_=o(6262);const y=(0,_.A)(m,[["render",v],["__scopeId","data-v-45aea742"]]);var E=y,S={name:"App",components:{DifferentuseGS3:E}};const T=(0,_.A)(S,[["render",r]]);var b=T;(0,n.Ef)(b).mount("#app")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}o.m=e,function(){var e=[];o.O=function(t,n,s,r){if(!n){var a=1/0;for(h=0;h<e.length;h++){n=e[h][0],s=e[h][1],r=e[h][2];for(var c=!0,i=0;i<n.length;i++)(!1&r||a>=r)&&Object.keys(o.O).every((function(e){return o.O[e](n[i])}))?n.splice(i--,1):(c=!1,r<a&&(a=r));if(c){e.splice(h--,1);var l=s();void 0!==l&&(t=l)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[n,s,r]}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,r,a=n[0],c=n[1],i=n[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(s in c)o.o(c,s)&&(o.m[s]=c[s]);if(i)var h=i(o)}for(t&&t(n);l<a.length;l++)r=a[l],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(h)},n=self["webpackChunkvue_googlesheets"]=self["webpackChunkvue_googlesheets"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(2978)}));n=o.O(n)})();
//# sourceMappingURL=app.1adb4823.js.map